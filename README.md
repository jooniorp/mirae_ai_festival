# mirae_ai_festival

미래에셋 대회 투자 분석 에이전트

---

## 프로젝트 개요

이 프로젝트는 네이버 종토방(토론방) 여론, 전문가 리서치 PDF, 실시간 주가 데이터를 통합 분석하여  
투자 판단을 내리는 AI 기반 투자 분석 에이전트입니다.

---

## LangChain 기반 ReAct 에이전트 구조

- 최신 데이터 자동 크롤링 및 임베딩 (매 실행 시마다 최신 데이터로 덮어쓰기)
- 분석 결과는 메모리(자기 발전 구조)에만 누적
- 성공적 분석 패턴을 학습하여 점점 더 똑똑해지는 자기 발전형 에이전트
- 한국어 자연어 질의 지원

---

## 주요 기능 및 구조

### 1. 종토방 여론 분석 (NaverDiscussionRAGPipeline.py)
- 네이버 종목 토론방에서 실시간 댓글/여론 크롤링
- 정치적/비속어 필터링, 종목 관련성 검증
- 세그멘테이션 및 임베딩 후 ChromaDB에 저장
- 투자자 심리, 시장 관심도, 여론 분포 요약

### 2. 전문가 리서치 분석 (ResearchRAGPipeline.py)
- PDF 폴더 내 리서치 리포트 자동 추출
- 투자의견, 목표주가 등 중요 정보 기반 문서 정렬
- 세그멘테이션 및 임베딩 후 ChromaDB에 저장
- 전문가 의견, 실적, 목표주가 등 핵심 정보 요약

### 3. 주가 데이터 분석 (StockPriceRAGPipeline.py)
- 실시간/최근 2달간의 주가 데이터 자동 수집
- 가격 변동, 추세, 주요 이슈 등 분석
- 임베딩 후 ChromaDB에 저장

### 4. 메모리 시스템 (agent_memory.py)
- 분석 결과(질문, 사용 도구, Observation, 최종 답변)를 memory.json에 저장
- 최대 5개, 상위 성과 2개 유지 (품질 평가 기반)
- 유사 질문/분석 recall, 최근/최고 성과 분석 조회, 패턴 추출 등 지원
- 자기 발전: 성공적인 분석 패턴을 학습하여 도구 순서/전략 최적화
- 분석 메모리만 누적/적재, 데이터/DB는 매번 최신화

### 5. 에이전트 (main_agent.py)
- ReAct 패턴: Thought → Action → Observation → 반복
- LLM이 한 번에 하나의 Action만 선택, 반드시 실제 코드 실행
- Observation은 도구 실행 결과만 기록 (LLM이 출력한 Observation 무시)
- MemoryTool 사용 시 'best', 'patterns', 'recall:질문' 등 명확한 액션만 허용
- 연속 도구 실행 실패 시 루프 강제 종료
- 최종 답변만 출력

---

## 사용 방법

### 환경 설정
- requirements.txt 설치
- .env 파일에 API 키 등 환경변수 설정

### 실행
- main_agent.py 실행
- "분석할 질문을 입력하세요:"에 자연어로 질문 입력  
  예: 삼성전자에 지금 투자하는게 올바를까?

### 분석 결과
- 종토방, 리서치, 주가 데이터 순으로 자동 분석
- 최종 투자 판단 및 요약 결과 출력

---

## 예시 질문

- 삼성전자에 지금 투자하는게 올바를까?
- 네이버 주식 어때?
- 카카오 투자해도 될까?
- 하이닉스 매수 타이밍인가?

---

## 메모리(자기 발전) 시스템 설명

- 분석 결과를 자동 저장하여, 유사한 질문이 들어오면 과거 성공적인 분석 패턴을 참고
- 품질 평가(도구 다양성, 답변 길이, 명확성, 최신성 등)로 상위 분석만 유지
- 최적화 힌트: 과거 성공 패턴을 바탕으로 도구 순서/전략을 추천
- 자기 발전: 반복될수록 더 똑똑한 분석 전략을 자동 학습
- 분석 메모리(memory.json)만 누적, 데이터/DB는 매번 최신화

---

## 기타

- 실행 시마다 크롤링/임베딩 데이터 및 ChromaDB는 항상 최신으로 덮어쓰기 (누적되지 않음)
- 분석 메모리(memory.json)만 누적/적재
- 오류 발생 시 Observation에 상세 오류 메시지 출력
- LLM 프롬프트에 따라 MemoryTool 사용 시 반드시 'best', 'patterns', 'recall:질문' 등 명확한 액션만 허용

---

## 시스템 동작 흐름

1. 질문 입력
2. 데이터/DB 최신화 (기존 데이터 삭제, memory.json만 보존)
3. 종토방 → 리서치 → 주가 데이터 순서로 자동 분석
4. 각 단계별 Observation 기록, 최종 판단 도출
5. 분석 결과는 memory.json에 누적, 자기 발전 구조로 활용
