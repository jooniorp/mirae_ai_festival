# Mirae Asset AI Festival - 투자 분석 에이전트

## 프로젝트 개요

이 프로젝트는 **뉴스 트리거 기반**으로 네이버 뉴스, 종토방(토론방) 여론, 전문가 리서치 PDF, 실시간 주가 데이터를 통합 분석하여 투자 판단을 내리는 AI 기반 투자 분석 에이전트입니다.

## 핵심 특징

- **뉴스 트리거 시스템**: 주가 변동 가능성이 있는 뉴스 감지 시에만 종합 분석 실행
- **실시간 데이터 분석**: 매 실행 시마다 최신 데이터로 자동 크롤링 및 임베딩
- **자기 발전형 메모리**: 성공적 분석 패턴을 학습하여 점진적으로 개선되는 지능형 시스템
- **한국어 자연어 처리**: 한국어 질의 및 분석 결과 제공
- **LangChain ReAct 패턴**: 체계적인 사고-행동-관찰 반복 구조
- **스마트 필터링**: 스포츠, 연예 등 기업 주가와 무관한 뉴스 자동 필터링

## 전체 시스템 아키텍처

### 1. 뉴스 트리거 분석 (NewsRAGTool) **첫 번째 실행 도구**
- 네이버 뉴스 API를 통한 실시간 뉴스 검색
- **스포츠/연예 뉴스 자동 필터링** (야구, 축구, 콘서트 등)
- 주가 변동 요인 자동 감지 (긍정/부정/변동성 키워드 분석)
- **조건부 실행**: 주가 변동 가능성이 높을 때만 추가 분석 진행
- 중요 뉴스 기사 영향도 점수화 및 우선순위 부여

### 2. 종토방 여론 분석 (NaverDiscussionRAGPipeline)
- 네이버 종목 토론방 실시간 댓글 크롤링
- 정치적/비속어 필터링 및 종목 관련성 검증
- 투자자 심리, 시장 관심도, 여론 분포 분석
- ChromaDB 기반 벡터 검색 및 요약

### 3. 전문가 리서치 분석 (ResearchRAGTool)
- 네이버 금융에서 특정 종목 관련 PDF 리서치 리포트 자동 크롤링
- 최대 3개 PDF 파일 자동 다운로드 및 저장
- 투자의견, 목표주가 등 핵심 정보 기반 문서 정렬
- 전문가 의견, 실적 전망, 목표주가 분석
- 세그멘테이션 및 임베딩 후 ChromaDB 저장

### 4. 주가 데이터 분석 (StockPriceRAGTool)
- 실시간 및 최근 2개월 주가 데이터 수집
- 가격 변동, 추세, 주요 이슈 분석
- 기술적 지표 및 패턴 분석

### 5. 메모리 시스템 (AgentMemory)
- 분석 결과 자동 저장 및 품질 평가
- 최대 5개 분석, 상위 성과 2개 유지
- 유사 질문 recall, 최근/최고 성과 조회
- 성공 패턴 학습을 통한 도구 순서 최적화

### 6. 최종 분석 (FinalAnalysis)
- 모든 도구의 결과를 종합하여 최종 투자 판단
- 투자 판단: 매수/매도/유지 중 명확한 선택
- 근거 분석: 종토방, 리서치, 주가 데이터별 구체적 근거
- 위험 요소 및 기회 요소 분석
- 구체적인 투자 전략과 주의사항 제시

### 7. 메인 에이전트 (main_agent)
- ReAct 패턴 기반 순차적 분석 실행
- **뉴스 트리거 기반 조건부 실행**: 안정적 뉴스 시 즉시 종료
- LLM 기반 도구 선택 및 실행 (중복 실행 방지)
- 연속 실패 시 루프 강제 종료
- 최종 투자 판단 및 요약 제공

## 설치 및 설정

### 1. 환경 설정
```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정
`.env` 파일을 생성하고 다음 내용을 추가:
```
NCP_CLOVASTUDIO_API_KEY=your_clova_studio_api_key
NCP_APIGW_API_KEY=your_api_gateway_key
NCP_CLOVASTUDIO_APP_ID_SEGMENTATION=your_segmentation_app_id
NAVER_CLIENT_ID=your_naver_client_id
NAVER_CLIENT_SECRET=your_naver_client_secret
```

### 3. 실행
```bash
python main_agent.py
```

## 사용 방법

### 질문 입력
프로그램 실행 후 자연어로 투자 관련 질문을 입력하세요.

**예시 질문:**
- 삼성전자
- SK하이닉스  
- LG에너지솔루션
- 현대차
- LG전자
- KIA

### 분석 과정

#### **뉴스 트리거 기반 조건부 실행**
1. **뉴스 트리거 분석**: 실시간 뉴스에서 주가 변동 요인 감지
   - **안정적 상태**: 추가 분석 없이 즉시 종료
   - **주가 변동 가능성 감지**: 다음 단계 진행

2. **데이터 최신화**: 기존 분석 데이터 삭제 (메모리 제외)

3. **종토방 분석**: 실시간 투자자 여론 수집 및 분석

4. **리서치 분석**: 전문가 리포트 기반 분석

5. **주가 분석**: 최근 주가 데이터 및 기술적 분석

6. **최종 통합 판단**: 모든 데이터를 종합한 최종 투자 의견

### 결과 출력
- 각 단계별 분석 결과
- 최종 투자 판단 및 근거
- 메모리 시스템에 분석 결과 자동 저장

## 뉴스 트리거 시스템 상세

### 필터링 기준
- **스포츠 관련 뉴스** (야구, 축구, 농구, 배구 등): 기업 주가와 무관하므로 "하"로 판단
- **연예/문화 관련 뉴스** (콘서트, 드라마, 영화 등): 기업 주가와 무관하므로 "하"로 판단
- **동명이인 관련 뉴스**: 같은 이름이지만 다른 분야의 인물/기관 관련 뉴스는 제외
- **기업의 스포츠팀/문화사업**: 해당 기업의 직접적인 경영 활동이 아닌 경우 "하"로 판단

### 주가 변동 가능성 판단 기준
- **상**: 실적 발표, 대규모 계약, 경영진 변화, 규제 변화, 노조 교섭 결렬, 파업, 경영권 분쟁, 관세 정책, 수출입 제한 등
- **중**: 신제품 출시, 시장 동향, 경쟁사 소식, 인수합병 소식, 공급망 이슈, 원자재 가격 변동, 환율 변동 등
- **하**: 일반적인 업계 소식, 마케팅 활동, 사소한 업무 소식, 문화/사회 활동, 스포츠 관련, 연예 관련 등

## 메모리 시스템 상세

### 품질 평가 기준
- **도구 사용 다양성** (최대 3점): 다양한 분석 도구 활용
- **관찰 결과 품질** (최대 2점): 상세한 분석 내용
- **최종 답변 품질** (최대 3점): 명확한 투자 의견 제시
- **분석 완성도** (최대 2점): 전체 분석 과정 완성

### 자기 발전 메커니즘
- 성공적인 분석 패턴 학습
- 도구별 성능 추적 및 최적화
- 회사별 인사이트 누적
- 유사 질문 시 과거 성공 패턴 활용

## 파일 구조

```
mirae_ai_festival/
├── main_agent.py                    # 메인 에이전트 (ReAct 패턴 + 뉴스 트리거)
├── AgentMemory.py                   # 메모리 시스템 (자기 발전)
├── NewsRAGPipeline.py               # 뉴스 트리거 분석 (새로 추가)
├── PDFResearchCrawler.py            # PDF 리서치 크롤러
├── NaverDiscussionRAGPipeline.py    # 종토방 여론 분석
├── ResearchRAGPipeline.py           # 전문가 리서치 분석
├── StockPriceRAGPipeline.py         # 주가 데이터 분석
├── FinalAnalysis.py                 # 최종 투자 판단
├── requirements.txt                 # 의존성 패키지
├── data/                            # 데이터 저장소
│   └── memory.json                 # 분석 메모리 (누적 저장)
├── pdf_downloads/                   # PDF 파일 저장소
└── chroma_langchain_db/             # 벡터 데이터베이스
```

## 기술 스택

- **LangChain**: AI 에이전트 프레임워크 (ReAct 패턴)
- **ChromaDB**: 벡터 데이터베이스 (임베딩 저장)
- **Clova X**: 한국어 LLM (분석 및 판단)
- **Selenium**: 웹 크롤링 (종토방 데이터)
- **BeautifulSoup**: HTML 파싱 (PDF 링크 추출)
- **PyMuPDF**: PDF 처리 (리서치 리포트)
- **Sentence Transformers**: 텍스트 임베딩 (벡터화)
- **Requests**: HTTP 요청 (PDF 다운로드, 뉴스 API)
- **Pandas**: 데이터 처리 (주가 데이터)

## 주요 개선사항

### v2.0 업데이트
- **뉴스 트리거 시스템 도입**: 주가 변동 가능성이 있는 뉴스 감지 시에만 종합 분석 실행
- **스마트 필터링**: 스포츠, 연예 등 기업 주가와 무관한 뉴스 자동 필터링
- **조건부 실행**: 안정적 뉴스 시 불필요한 분석 중단으로 효율성 증대
- **LLM 메모리 개선**: 이전 실행 결과 정확한 기억 및 중복 실행 방지
- **PDF 크롤링 개선**: 연속 빈 페이지 제한 증가 (5→10페이지), 최대 검색 페이지 제한 (50→30페이지)
- **회사명 매핑 개선**: "기아" → "KIA"로 변경하여 스포츠 뉴스 혼동 방지
- **중복 출력 제거**: 최종 분석 결과의 중복 헤더 제거로 깔끔한 출력

## 주의사항

- **뉴스 트리거 시스템**: 주가 변동 가능성이 낮은 뉴스는 추가 분석 없이 즉시 종료됩니다
- 실행 시마다 크롤링 데이터 및 ChromaDB가 최신으로 덮어쓰기됩니다
- 분석 메모리(memory.json)만 누적 저장됩니다
- API 키는 반드시 환경 변수로 설정하세요
- 네트워크 연결이 필요합니다
- PDF 크롤링은 최대 3회로 제한되어 있으며, 최대 30페이지까지만 검색합니다
- **지원 종목**: 삼성전자, SK하이닉스, LG에너지솔루션, 현대차, LG전자, KIA

## 라이선스

이 프로젝트는 미래에셋 AI 페스티벌을 위해 개발되었습니다. 
